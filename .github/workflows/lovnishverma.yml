name: lovnishverma
on:
  schedule:
    # Run every 30 minutes (24/7)
    - cron: '*/30 * * * *'
  
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1  # <--- CHANGED: Keeps the action fast even with 10k+ commits
          
      - name: Configure Git
        run: |
          git config --global user.name "lovnishverma"
          git config --global user.email "princelv84@gmail.com"

      - name: Generate High-Density Commits
        run: |
          mkdir -p .sync/density
          
          # Randomly decide how many commits (5 to 15)
          COMMIT_COUNT=$(( ( RANDOM % 11 ) + 5 ))
          
          echo "Generating $COMMIT_COUNT commits..."
          
          for i in $(seq 1 $COMMIT_COUNT); do
            TIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S.%N')
            echo "Log entry $i: $TIMESTAMP - Random: $RANDOM" >> .sync/density/trace.log
            
            git add .sync/density/trace.log
            
            MESSAGES=(
              "Update density matrix $RANDOM"
              "Refine sync logic parameters"
              "Optimize background process"
              "Incremental data flush"
              "Update trace logs"
              "System heartbeat pulse"
              "Re-index search nodes"
              "Cache invalidation step"
            )
            MSG=${MESSAGES[$RANDOM % ${#MESSAGES[@]}]}
            
            git commit -m "$MSG"
            
            # Short sleep is fine
            sleep 1
          done

      - name: Maintain Daily Stats
        run: |
          mkdir -p .sync/daily
          DATE=$(date '+%Y-%m-%d')
          echo "Run at $(date)" >> ".sync/daily/data_${DATE}.log"
          git add .sync/daily/
          git commit -m "Daily summary log update" || echo "No daily changes"

      - name: Push all changes
        run: git push
          
      - name: Cleanup old logs
        run: |
          # Delete density logs older than 3 days
          find .sync/density -name "*.log" -type f -mtime +3 -delete
          
          git add .sync/density
          git diff --staged --quiet || git commit -m "Prune old density logs"
          git push
